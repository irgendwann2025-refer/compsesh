WHITELIST=(
 "accounts-daemon"
 "arc_evict"
 "arc_prune"
 "arc_reap"
 "at-spi2-registr"
 "at-spi-bus-laun"
 "avahi-daemon"
 "bash"
 "colord"
 "COMMAND"
 "cpuhp/0"
 "cpuhp/1"
 "cron"
 "cups-browsed"
 "cupsd"
 "dbu_evict"
 "dbuf_evict"
 "dbus-daemon"
 "dconf-service"
 "ecryptfs-kthread"
 "evolution-addre"
 "evolution-alarm"
 "evolution-calen"
 "evolution-sourc"
 "fusermount3"
 "fwupd"
 "gcr-ssh-agent"
 "gdm3"
 "gdm-session-wor"
 "gdm-x-session"
 "gjs"
 "gnome-keyring-d"
 "gnome-remote-de"
 "gnome-session-b"
 "gnome-session-c"
 "gnome-shell"
 "gnome-shell-cal"
 "gnome-terminal-"
 "goa-daemon"
 "goa-identity-se"
 "gpg-agent"
 "gsd-a11y-settin"
 "gsd-color"
 "gsd-datetime"
 "gsd-disk-utilit"
 "gsd-housekeepin"
 "gsd-keyboard"
 "gsd-media-keys"
 "gsd-power"
 "gsd-printer"
 "gsd-print-notif"
 "gsd-rfkill"
 "gsd-screensaver"
 "gsd-sharing"
 "gsd-smartcard"
 "gsd-sound"
 "gsd-wacom"
 "gsd-xsettings"
 "gvfs-afc-volume"
 "gvfsd"
 "gvfsd-fuse"
 "gvfsd-metadata"
 "gvfsd-trash"
 "gvfs-goa-volume"
 "gvfs-gphoto2-vo"
 "gvfs-mtp-volume"
 "gvfs-udisks2-vo"
 "ibus-daemon"
 "ibus-dconf"
 "ibus-engine-sim"
 "ibus-extension-"
 "ibus-portal"
 "ibus-x11"
 "idle_inject/0"
 "idle_inject/1"
 "irq/16-vmwgfx"
 "irq/24-pciehp"
 "irq/25-pciehp"
 "irq/26-pciehp"
 "irq/27-pciehp"
 "irq/28-pciehp"
 "irq/29-pciehp"
 "irq/30-pciehp"
 "irq/31-pciehp"
 "irq/32-pciehp"
 "irq/33-pciehp"
 "irq/34-pciehp"
 "irq/35-pciehp"
 "irq/36-pciehp"
 "irq/37-pciehp"
 "irq/38-pciehp"
 "irq/39-pciehp"
 "irq/40-pciehp"
 "irq/41-pciehp"
 "irq/42-pciehp"
 "irq/43-pciehp"
 "irq/44-pciehp"
 "irq/45-pciehp"
 "irq/46-pciehp"
 "irq/47-pciehp"
 "irq/48-pciehp"
 "irq/49-pciehp"
 "irq/50-pciehp"
 "irq/51-pciehp"
 "irq/52-pciehp"
 "irq/53-pciehp"
 "irq/54-pciehp"
 "irq/55-pciehp"
 "irq/57-vmw_vmci"
 "irq/58-vmw_vmci"
 "irq/59-vmw_vmci"
 "irq/9-acpi"
 "jfsCommit"
 "jfsIO"
 "jfsSync"
 "kauditd"
 "kcompactd0"
 "kdevtmpfs"
 "kerneloops"
 "khugepaged"
 "khungtaskd"
 "ksmd"
 "ksoftirqd/0"
 "ksoftirqd/1"
 "kswapd0"
 "kthreadd"
 "kworker/0:0-cgroup_destroy"
 "kworker/0:0H-kblockd"
 "kworker/0:1"
 "kworker/0:1H-kblockd"
 "kworker/0:2-events"
 "kworker/1:0"
 "kworker/1:0H-events_highpri"
 "kworker/1:1-events"
 "kworker/1:1H-kblockd"
 "kworker/1:2-cgroup_destroy"
 "kworker/R-acpi_thermal_pm"
 "kworker/R-ata_sff"
 "kworker/R-blkcg_punt_bio"
 "kworker/R-charger_manager"
 "kworker/R-cryptd"
 "kworker/R-devfreq_wq"
 "kworker/R-edac-poller"
 "kworker/R-inet_frag_wq"
 "kworker/R-ipv6_addrconf"
 "kworker/R-kblockd"
 "kworker/R-kintegrityd"
 "kworker/R-kstrp"
 "kworker/R-kthrotld"
 "kworker/R-kvfree_rcu_reclaim"
 "kworker/R-md"
 "kworker/R-md_bitmap"
 "kworker/R-mld"
 "kworker/R-mm_percpu_wq"
 "kworker/R-mpt/0"
 "kworker/R-mpt_poll_0"
 "kworker/R-netns"
 "kworker/R-raid5wq"
 "kworker/R-rcu_gp"
 "kworker/R-scsi_tmf_0"
 "kworker/R-scsi_tmf_1"
 "kworker/R-scsi_tmf_10"
 "kworker/R-scsi_tmf_11"
 "kworker/R-scsi_tmf_12"
 "kworker/R-scsi_tmf_13"
 "kworker/R-scsi_tmf_14"
 "kworker/R-scsi_tmf_15"
 "kworker/R-scsi_tmf_16"
 "kworker/R-scsi_tmf_17"
 "kworker/R-scsi_tmf_18"
 "kworker/R-scsi_tmf_19"
 "kworker/R-scsi_tmf_2"
 "kworker/R-scsi_tmf_20"
 "kworker/R-scsi_tmf_21"
 "kworker/R-scsi_tmf_22"
 "kworker/R-scsi_tmf_23"
 "kworker/R-scsi_tmf_24"
 "kworker/R-scsi_tmf_25"
 "kworker/R-scsi_tmf_26"
 "kworker/R-scsi_tmf_27"
 "kworker/R-scsi_tmf_28"
 "kworker/R-scsi_tmf_29"
 "kworker/R-scsi_tmf_3"
 "kworker/R-scsi_tmf_30"
 "kworker/R-scsi_tmf_31"
 "kworker/R-scsi_tmf_32"
 "kworker/R-scsi_tmf_4"
 "kworker/R-scsi_tmf_5"
 "kworker/R-scsi_tmf_6"
 "kworker/R-scsi_tmf_7"
 "kworker/R-scsi_tmf_8"
 "kworker/R-scsi_tmf_9"
 "kworker/R-slub_flushwq"
 "kworker/R-sync_wq"
 "kworker/R-tpm_dev_wq"
 "kworker/R-ttm"
 "kworker/R-writeback"
 "kworker/R-xfsalloc"
 "kworker/R-xfs_mru_cache"
 "kworker/u512:0-ipv6_addrconf"
 "kworker/u512:1-ipv6_addrconf"
 "kworker/u513:0-events_power_efficient"
 "kworker/u513:1"
 "kworker/u513:23-events_unbound"
 "kworker/u513:25-kvfree_rcu_reclaim"
 "kworker/u513:27-events_freezable_pwr_efficient"
 "kworker/u514:1-events_freezable_pwr_efficient"
 "kworker/u514:2-events_unbound"
 "kworker/u514:3-events_power_efficient"
 "kworker/u514:7-events_power_efficient"
 "kworker/u515:0"
 "kworker/u516:3-ttm"
 "kworker/u516:4-ttm"
 "kworker/u517:0-ttm"
 "kworker/u517:1-ttm"
 "l2arc_feed"
 "migration/0"
 "migration/1"
 "ModemManager"
 "mutter-x11-fram"
 "NetworkManager"
 "oom_reaper"
 "pipewire"
 "pipewire-pulse"
 "polkitd"
 "pool_workqueue_release"
 "power-profiles-"
 "ps"
 "psimon"
 "python3.10"
 "rcu_exp_gp_kthread_worker"
 "rcu_exp_par_gp_kthread_worker/1"
 "rcu_preempt"
 "rcu_tasks_kthread"
 "rcu_tasks_rude_kthread"
 "rcu_tasks_trace_kthread"
 "rsyslogd"
 "rtkit-daemon"
 "scsi_eh_0"
 "scsi_eh_1"
 "scsi_eh_10"
 "scsi_eh_11"
 "scsi_eh_12"
 "scsi_eh_13"
 "scsi_eh_14"
 "scsi_eh_15"
 "scsi_eh_16"
 "scsi_eh_17"
 "scsi_eh_18"
 "scsi_eh_19"
 "scsi_eh_2"
 "scsi_eh_20"
 "scsi_eh_21"
 "scsi_eh_22"
 "scsi_eh_23"
 "scsi_eh_24"
 "scsi_eh_25"
 "scsi_eh_26"
 "scsi_eh_27"
 "scsi_eh_28"
 "scsi_eh_29"
 "scsi_eh_3"
 "scsi_eh_30"
 "scsi_eh_31"
 "scsi_eh_32"
 "scsi_eh_4"
 "scsi_eh_5"
 "scsi_eh_6"
 "scsi_eh_7"
 "scsi_eh_8"
 "scsi_eh_9"
 "(sd-pam)"
 "sed"
 "snapd"
 "snapd-desktop-i"
 "sort"
 "spl_delay_taskq"
 "spl_dynamic_tas"
 "spl_kmem_cache"
 "spl_system_task"
 "subiquity-serve"
 "switcheroo-cont"
 "systemd"
 "systemd-journal"
 "systemd-logind"
 "systemd-oomd"
 "systemd-resolve"
 "systemd-timesyn"
 "systemd-udevd"
 "tracker-miner-f"
 "udisksd"
 "unattended-upgr"
 "update-notifier"
 "upowerd"
 "watchdogd"
 "whitelist_gen.s"
 "wireplumber"
 "wpa_supplicant"
 "xdg-desktop-por"
 "xdg-document-po"
 "xdg-permission-"
 "Xorg"
 "zed"
 "z_vdev_file"
 "zvol_tq-0"
)
# Add current scripts shell
WHITELIST+=("$$")

# Create regex pattern from whitelist
pattern=$(printf "|%s" "${WHITELIST[@]}")
pattern=${pattern:1}

ps -eo pid,comm | tail -n +2 | while read pid comm; do
    if [[ "$comm" =~ ^($pattern)$ ]]; then
        echo "Skipping:   $pid ($comm)"
    else
        echo "Killing: $pid ($comm)"
	kill -9 "$pid"
    fi
done
